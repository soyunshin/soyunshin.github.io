---
title:  "[Dacon 02] 여행 상품 신청 여부 예측 경진대회 (작성중)"
excerpt: "Binary classification for travel package purchase Prediction'"

categories:
  - Data Analytics
tags:
  - [Data Analytics]

toc: true
toc_sticky: true
 
date: 2022-08-30
last_modified_at: 2022-08-30
---

# 0. 문제 정의

본 데이터는 여행 패키지 신청 여부를 예측할 수 있는 고객 데이터이다.

분석 목표는 고객 데이터를 이용해  <mark style = 'background-color:#fff5b1'>여행 패키지의 수요를 미리 예측</mark>하여 여행 패키지를 기획하는데 있다.

ProdTaken을 예측하는 이진 분류 문제이다.
{: .notice--info}


사용 Model

 - ExtraTreesClassifier
 
<br>


# 1. 필요한 환경 설정
# 1.1 Colab 환경에서 데이터 바로 받기

```python
import requests

import os
import os.path as pth

from multiprocessing import Pool
from functools import partial

from tqdm.notebook import tqdm

import zipfile
```


```python
def download_file_from_google_drive(id_, destination):
    URL = "https://docs.google.com/uc?export=download"

    session = requests.Session()
    response = session.get(URL, params = { 'id' : id_ }, stream = True)
    token = get_confirm_token(response)
    if token:
        params = { 'id' : id_, 'confirm' : token }
        response = session.get(URL, params = params, stream = True)
        
    basename = response.headers['Content-Disposition'].split(';')[1].split('filename=')[1].replace('\"', '')
    full_dst_filenname = pth.join(destination, basename)
    save_response_content(response, full_dst_filenname)
    return full_dst_filenname

def get_confirm_token(response):
    for key, value in response.cookies.items():
        if key.startswith('download_warning'):
            return value

    return None

def save_response_content(response, destination):
    CHUNK_SIZE = 32768
    with open(destination, "wb") as f:
        for chunk in response.iter_content(CHUNK_SIZE):
            if chunk: # filter out keep-alive new chunks
                f.write(chunk)
```

`file_id_list`에 해당 데이터가 저장된 구글 드라이브 경로를 다음과 같이 작성한다.

```python
file_id_list = [
    '1lfI6JbmsNNb2f_Je27p3-mTcI7XCOcQI',
]
```

`destination` 에 압축이 해제된 파일이 들어가게된다. (여기서는 `data`폴더에 데이터 폴더가 저장)

```python
destination = 'data' ### YOUR_DOWNLOAD_PATH
os.makedirs(destination, exist_ok=True)

filename_list = []

download_func = partial(download_file_from_google_drive, destination=destination)
with Pool(4) as pool:
    for i, filename in tqdm(enumerate(pool.imap_unordered(download_func, file_id_list)), total=len(file_id_list)):
        print('{} is done!'.format(filename))
        filename_list.append(filename)
```


압축 해제

```python
zip_filename_list = [filename for filename in filename_list if filename.endswith('.zip')]
    
for zip_filename in tqdm(zip_filename_list):
    with zipfile.ZipFile(zip_filename) as target_zip:
        dest_path = pth.splitext(zip_filename)[0]
        os.makedirs(dest_path, exist_ok=True)
        target_zip.extractall(dest_path)
        print('{} is done!'.format(dest_path))
```